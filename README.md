# ZeppOS Nightscout Watchface + Companion App (ZeppOS 3)

This repository contains a ZeppOS watchface and companion mini app that fetch blood glucose data from a Nightscout server and display it on supported square-screen Amazfit devices.

## Supported devices

- This is a ZeppOS 3 “universal” watchface intended for square-screen Amazfit watches.
- Tested:
  - Amazfit Bip 5 Unity
  - Amazfit Bip 6
  - Amazfit Cheetah (Square)
  - Amazfit Active
  - Amazfit GTS 4
- It should also work on other square-screen Amazfit watches that support ZeppOS 3.

Device targets are defined in `watchface/app.json` and `app/app.json`.

### Watchface Screenshot

![Watchface Screenshot](screenshot_wf.png)

## Features

- **Blood Glucose Display**: Shows your current blood glucose (BG) level fetched directly from your Nightscout server.
- **Trend Information**: Indicates the direction in which your BG levels are moving.
- **Update Timestamp**: Displays the time elapsed since the last BG data was fetched, ensuring you're aware of the data's freshness.
- **Simplified Interface**: Focuses on the essentials - your BG level, trend, and update time - for clarity and ease of use.

## Background

This project is inspired by and borrows significantly from existing xDrip ZeppOS projects. Special thanks to the developers of the following repositories for their foundational work:

- [WatchDrip Timer WF by 4RK4N](https://github.com/4RK4N/zeppos_watchdrip_timer_wf)
- [WatchDrip Timer WF by bigdigital](https://github.com/bigdigital/zeppos_watchdrip_timer_wf)

Unlike the referenced projects that rely on a local xDrip app, this watchface leverages the Nightscout backend, making your data accessible directly from your Nightscout server without the need for a local intermediary. The focus is on maintaining a lean and straightforward project, prioritizing ease of use and essential functionality.

## Project Structure

This repository consists of two main components:

### 1. Watchface (`/watchface`)
- Custom watchface for supported square-screen devices
- Displays blood glucose data directly on the watch face
- Built using ZeppOS framework
- Key files:
  - `app.json`: Watchface configuration and metadata
  - `index.js`: Main watchface logic
  - `page/index.js`: Watchface UI implementation

### 2. Companion App (`/app`)
- ZeppOS mini app that runs alongside the watchface
- Handles communication with Nightscout server
- Manages settings and data synchronization
- Key files:
  - `app.json`: App configuration and metadata
  - `app-side/index.js`: Main app logic for phone-side operations
  - `page/index.js`: App UI implementation

### Additional Resources
- `ns_icon*.png`: Various Nightscout icons used in the app
- `icon_240x240.png`: App icon
- `screenshot_wf.png`: Watchface screenshot

## App Settings

Within the Zepp app, you'll find the settings page for this watchface. Here, you can configure the following:

- **Nightscout Host URL**: The web address of your Nightscout server.
- **Access Token**: If your Nightscout server requires an access token, enter it here.
- **Update Interval**: Set how frequently the watchface updates your BG data. Note that more frequent updates may lead to increased battery consumption.

## Getting Started

### Development Prerequisites
1. Install Node.js and npm
2. Install Zeus CLI tool: `npm install -g @zeppos/zeus-cli`
3. Configure your development environment following the ZeppOS documentation:
   - https://docs.zepp.com/docs/guides/quick-start/environment/
   - https://docs.zepp.com/docs/guides/tools/cli/
   - https://docs.zepp.com/docs/guides/tools/simulator/

### Development Setup
1. Clone this repository
2. Install dependencies:
   ```bash
   # In both /watchface and /app directories
   zeus install
   ```
3. Start simulator compilation preview:
   ```bash
   # For watchface
   cd watchface
   zeus dev

   # For companion app
   cd app
   zeus dev
   ```

## Install / Preview on a real device

ZeppOS projects are typically installed via QR code generated by `zeus preview`.

1. Enable Zepp App Developer Mode
2. In the project you want to run (either `watchface/` or `app/`), run:
   ```bash
   zeus login
   zeus preview
   ```
3. Select the appropriate target when prompted.
4. Scan the QR code in the Zepp App (Developer Mode) to install.

Note: the watchface reads BG data from a file owned by the companion app, so you generally need to install both.

## Installation

1. Install the companion app from `app/` using `zeus preview`.
2. Install the watchface from `watchface/` using `zeus preview`.
3. In the Zepp App, open the companion app settings and configure:
   - Nightscout Server URL
   - Access token (if required by your Nightscout instance)
   - Update interval
   - Disable updates (optional)

## Disclaimer

Please note that this project is still in the experimental phase and may contain bugs. It has not undergone rigorous testing, and its reliability in different scenarios has not been fully validated. Use it at your own risk and discretion.


## Contribution

Your contributions, bug reports, and suggestions are welcome! This project is open for collaboration to improve, enhance, and expand its capabilities. Feel free to fork the repository, submit pull requests, or open issues to discuss potential features or report problems.

## Acknowledgements

A heartfelt thank you to the Nightscout community and the developers of the referenced repositories for their foundational work.